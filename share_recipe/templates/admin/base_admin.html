{% extends 'base.html' %}

{% block content %}
<style>
.admin-layout {
    margin-top: 30px;
    margin-bottom: 50px;
    font-family: 'Montserrat', sans-serif;
}

.admin-layout .container {
    display: block !important;
}

.sidebar {
    background-color: #28a745;
    border-radius: 10px;
    padding: 20px;
    height: 100%;
}

.sidebar .nav-link {
    color: #fff;
    padding: 8px 10px;
    margin: 5px 0;
    border-radius: 5px;
    transition: all 0.3s ease;
    font-size: 0.95rem;
    font-weight: 500;
    letter-spacing: 0.3px;
}

.sidebar .nav-link:hover,
.sidebar .nav-link.active {
    background-color: rgba(255,255,255,0.2);
    transform: translateX(5px);
}

.sidebar .nav-link i {
    width: 24px;
    text-align: center;
    margin-right: 8px;
}

.admin-avatar {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid rgba(255,255,255,0.3);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.admin-name {
    color: #fff;
    font-size: 1.1rem;
    margin-top: 12px;
    font-weight: 600;
    letter-spacing: 0.5px;
}

.content-wrapper {
    background-color: #fff;
    border-radius: 10px;
    padding: 25px;
    box-shadow: 0 2px 15px rgba(0,0,0,0.05);
}

.content-title {
    font-family: 'Playfair Display', serif;
    color: #333;
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 20px;
    border-bottom: 2px solid #28a745;
    padding-bottom: 10px;
    display: inline-block;
}

@media (max-width: 768px) {
    .sidebar {
        margin-bottom: 20px;
    }
    .admin-name {
        font-size: 1rem;
    }
    .content-title {
        font-size: 1.5rem;
    }
}
</style>

<div class="admin-layout">
    <div class="container">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 mb-4">
                <div class="sidebar">
                    <div class="text-center mb-4">
                        {% if g.user['avatar_path'] %}
                            <img src="{{ url_for('static', filename=g.user['avatar_path']) }}" alt="Admin" class="admin-avatar">
                        {% else %}
                            <img src="{{ url_for('static', filename='uploads/default-avatar.png') }}" alt="Admin" class="admin-avatar">
                        {% endif %}
                        <div class="admin-name">{{ g.user['username'] }}</div>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if request.endpoint == 'admin.dashboard' %}active{% endif %}" href="{{ url_for('admin.dashboard') }}">
                                <i class="fas fa-tachometer-alt"></i> Tổng quan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if request.endpoint == 'admin.users' %}active{% endif %}" href="{{ url_for('admin.users') }}">
                                <i class="fas fa-users"></i> Quản lý người dùng
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if request.endpoint == 'admin.posts' %}active{% endif %}" href="{{ url_for('admin.posts') }}">
                                <i class="fas fa-file-alt"></i> Quản lý bài viết
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main content -->
            <div class="col-md-9">
                <div class="content-wrapper">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center">
                        <h1 class="content-title">{% block admin_title %}{% endblock %}</h1>
                    </div>
                    {% block admin_content %}{% endblock %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Select all posts
        const selectAllPosts = document.getElementById('select-all-posts');
        const postCheckboxes = document.querySelectorAll('.select-post');
        selectAllPosts.addEventListener('change', function() {
            postCheckboxes.forEach(checkbox => checkbox.checked = this.checked);
        });

        // Delete selected posts
        const deleteSelectedPosts = document.getElementById('delete-selected-posts');
        deleteSelectedPosts.addEventListener('click', function() {
            const selectedIds = Array.from(postCheckboxes)
                .filter(checkbox => checkbox.checked)
                .map(checkbox => checkbox.value);
            if (selectedIds.length > 0) {
                fetch('/admin/delete_posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ ids: selectedIds })
                }).then(response => {
                    if (response.ok) {
                        location.reload();
                    }
                });
            }
        });

        // Sort posts
        const sortPosts = document.getElementById('sort-posts');
        sortPosts.addEventListener('change', function() {
            const sortOrder = this.value;
            window.location.href = `/admin/posts?sort=${sortOrder}`;
        });

        // Select all users
        const selectAllUsers = document.getElementById('select-all-users');
        const userCheckboxes = document.querySelectorAll('.select-user');
        selectAllUsers.addEventListener('change', function() {
            userCheckboxes.forEach(checkbox => checkbox.checked = this.checked);
        });

        // Delete selected users
        const deleteSelectedUsers = document.getElementById('delete-selected-users');
        deleteSelectedUsers.addEventListener('click', function() {
            const selectedIds = Array.from(userCheckboxes)
                .filter(checkbox => checkbox.checked)
                .map(checkbox => checkbox.value);
            if (selectedIds.length > 0) {
                fetch('/admin/delete_users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ ids: selectedIds })
                }).then(response => {
                    if (response.ok) {
                        location.reload();
                    }
                });
            }
        });
    });
</script>
{% endblock %} 